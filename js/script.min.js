(function ($) {
	'use strict';
	$(document).ready(function() {
		$(document).on('click','.js-get-raider',function(event){
			event.preventDefault();
			let btn 			= 	$(this),
				passwordInput 	= 	btn.prev(),
				pageId 			= 	passwordInput.prev().val();

			if (passwordInput.is(':hidden')) {
				passwordInput.toggleClass('d-none');
			} else {
				$('.alert').remove();
				if(passwordInput.val().length > 0) {
					$.ajax({
						type: 'GET',
						url: '/local/include/ajax/dashboard.php',
						xhrFields: {
							responseType: 'blob'
						},
						data: {
							'action':'getRaiderFile',
							'password':passwordInput.val(),
							'pageId':pageId,
						},
						async: true,
						cache: false,
						success: function(data, textStatus, request){
							let a 	= 	document.createElement('a'),
								url = 	window.URL.createObjectURL(data);

							a.href = url;
							a.download = request.getResponseHeader('Content-Filename');
							document.body.append(a);
							a.click();
							a.remove();
							window.URL.revokeObjectURL(url);
						},
						statusCode: {
							401: function() {
								btn.after('<span class="alert alert-danger mt-2">Неправильный пароль</span>');
							}
						}
					});
				} else {
					btn.after('<span class="alert alert-danger mt-2">Пустой пароль</span>');
				}
			}
		})
	});

}(jQuery));